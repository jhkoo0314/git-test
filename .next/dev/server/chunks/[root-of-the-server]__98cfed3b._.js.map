{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/bid%20master/app/api/collect-user-info/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { google } from \"googleapis\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log(\"📝 사용자 정보 수집 API 호출\"); // 로그 추가\r\n\r\n    const body = await request.json();\r\n    const { name, email, propertyTitle } = body;\r\n\r\n    // 필수 필드 검증\r\n    if (!name || !email) {\r\n      console.error(\"❌ 필수 필드 누락:\", { name, email }); // 로그 추가\r\n      return NextResponse.json(\r\n        { success: false, error: \"이름과 이메일은 필수입니다.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 환경 변수 검증\r\n    const privateKey = process.env.GOOGLE_SHEETS_PRIVATE_KEY;\r\n    const clientEmail = process.env.GOOGLE_SHEETS_CLIENT_EMAIL;\r\n    const sheetId = process.env.GOOGLE_SHEET_ID;\r\n\r\n    if (!privateKey || !clientEmail || !sheetId) {\r\n      console.error(\"❌ 구글 시트 환경 변수 누락\"); // 로그 추가\r\n      return NextResponse.json(\r\n        { success: false, error: \"서버 설정 오류가 발생했습니다.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // 구글 시트 API 인증 설정\r\n    const auth = new google.auth.GoogleAuth({\r\n      credentials: {\r\n        private_key: privateKey.replace(/\\\\n/g, \"\\n\"),\r\n        client_email: clientEmail,\r\n      },\r\n      scopes: [\"https://www.googleapis.com/auth/spreadsheets\"],\r\n    });\r\n\r\n    const sheets = google.sheets({ version: \"v4\", auth });\r\n\r\n    // 현재 시간\r\n    const timestamp = new Date().toLocaleString(\"ko-KR\", {\r\n      timeZone: \"Asia/Seoul\",\r\n      year: \"numeric\",\r\n      month: \"2-digit\",\r\n      day: \"2-digit\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n      second: \"2-digit\",\r\n    });\r\n\r\n    // 시트에 데이터 추가\r\n    const values = [[name, email, propertyTitle || \"알 수 없음\", timestamp]];\r\n\r\n    console.log(\"📊 구글 시트에 데이터 추가:\", {\r\n      name,\r\n      email,\r\n      propertyTitle,\r\n      timestamp,\r\n    }); // 로그 추가\r\n\r\n    await sheets.spreadsheets.values.append({\r\n      spreadsheetId: sheetId,\r\n      range: \"A:D\", // A열부터 D열까지\r\n      valueInputOption: \"RAW\",\r\n      requestBody: {\r\n        values: values,\r\n      },\r\n    });\r\n\r\n    console.log(\"✅ 구글 시트 데이터 추가 성공\"); // 로그 추가\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"정상 처리되었습니다. 정식출시가 되면 알려 드리겠습니다.\",\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ 구글 시트 연동 오류:\", error); // 로그 추가\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: \"데이터 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\",\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;;;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,QAAQ,GAAG,CAAC,wBAAwB,QAAQ;QAE5C,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,aAAa,EAAE,GAAG;QAEvC,WAAW;QACX,IAAI,CAAC,QAAQ,CAAC,OAAO;YACnB,QAAQ,KAAK,CAAC,eAAe;gBAAE;gBAAM;YAAM,IAAI,QAAQ;YACvD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAkB,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,WAAW;QACX,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB;QACxD,MAAM,cAAc,QAAQ,GAAG,CAAC,0BAA0B;QAC1D,MAAM,UAAU,QAAQ,GAAG,CAAC,eAAe;QAE3C,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,SAAS;YAC3C,QAAQ,KAAK,CAAC,qBAAqB,QAAQ;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,OAAO,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,aAAa,WAAW,OAAO,CAAC,QAAQ;gBACxC,cAAc;YAChB;YACA,QAAQ;gBAAC;aAA+C;QAC1D;QAEA,MAAM,SAAS,OAAO,MAAM,CAAC;YAAE,SAAS;YAAM;QAAK;QAEnD,QAAQ;QACR,MAAM,YAAY,IAAI,OAAO,cAAc,CAAC,SAAS;YACnD,UAAU;YACV,MAAM;YACN,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;YACR,QAAQ;QACV;QAEA,aAAa;QACb,MAAM,SAAS;YAAC;gBAAC;gBAAM;gBAAO,iBAAiB;gBAAU;aAAU;SAAC;QAEpE,QAAQ,GAAG,CAAC,qBAAqB;YAC/B;YACA;YACA;YACA;QACF,IAAI,QAAQ;QAEZ,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,eAAe;YACf,OAAO;YACP,kBAAkB;YAClB,aAAa;gBACX,QAAQ;YACV;QACF;QAEA,QAAQ,GAAG,CAAC,sBAAsB,QAAQ;QAE1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB,QAAQ,QAAQ;QAEhD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}