# Google Sheets 연동 사용 가이드

Bid Master에서 구글 시트 연동 기능을 사용하는 방법을 설명합니다.

## 📋 목차

1. [개요](#개요)
2. [자동 저장 기능](#자동-저장-기능)
3. [수동으로 데이터 저장하기](#수동으로-데이터-저장하기)
4. [구글 시트에서 데이터 읽어오기](#구글-시트에서-데이터-읽어오기)
5. [데이터 분석 활용](#데이터-분석-활용)
6. [문제 해결](#문제-해결)

---

## 개요

Bid Master는 구글 시트 연동을 통해 경매 시뮬레이션 결과를 자동으로 저장하고 분석할 수 있습니다.

### 주요 기능

- ✅ **자동 저장**: 입찰 완료 시 자동으로 구글 시트에 결과 저장
- 📊 **데이터 조회**: API를 통해 저장된 데이터 조회
- 📈 **분석 지원**: 구글 시트의 차트 및 함수를 활용한 데이터 분석
- 🔄 **실시간 동기화**: 여러 기기에서 실시간으로 데이터 확인

### 저장되는 데이터

구글 시트에는 다음 정보가 저장됩니다:

| 항목       | 설명                 | 예시                      |
| ---------- | -------------------- | ------------------------- |
| 날짜       | 입찰한 날짜          | 2025-10-23                |
| 사용자ID   | 사용자 고유 ID       | user-12345                |
| 매물제목   | 경매 매물 이름       | 강남구 래미안 101동 501호 |
| 감정가     | 매물 감정가          | 500,000,000               |
| 시작입찰가 | 경매 시작가          | 350,000,000               |
| 최종입찰가 | 사용자가 입찰한 금액 | 400,000,000               |
| 결과       | 입찰 성공/실패       | 성공                      |
| 손익       | 수익 또는 손실 금액  | 100,000,000               |

---

## 자동 저장 기능

### 작동 방식

사용자가 입찰을 완료하면 자동으로 구글 시트에 결과가 저장됩니다.

```
사용자 입찰 → 입찰 처리 → 시뮬레이션 결과 계산 → 구글 시트 자동 저장
```

### 설정 확인

자동 저장 기능을 사용하려면 `.env.local` 파일에 환경 변수가 설정되어 있어야 합니다:

```env
GOOGLE_SHEETS_SPREADSHEET_ID="your-spreadsheet-id"
GOOGLE_SERVICE_ACCOUNT_EMAIL="your-service-account@project.iam.gserviceaccount.com"
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

⚠️ 환경 변수가 설정되지 않으면 구글 시트 저장을 건너뛰지만, 입찰 처리는 정상적으로 진행됩니다.

### 저장 확인

1. 입찰 완료 후 구글 시트를 엽니다
2. "경매결과" 시트를 확인합니다
3. 새로운 행에 입찰 결과가 추가되었는지 확인합니다

**서버 로그:**

```
📊 구글 시트에 결과 저장 시작
✅ 구글 시트에 결과 저장 완료
```

---

## 수동으로 데이터 저장하기

API를 직접 호출하여 데이터를 저장할 수도 있습니다.

### API 엔드포인트

```
POST /api/sheets/append
```

### 요청 예시

**curl 사용:**

```bash
curl -X POST http://localhost:3000/api/sheets/append \
  -H "Content-Type: application/json" \
  -d '{
    "date": "2025-10-23",
    "userId": "user-12345",
    "itemTitle": "강남구 래미안 101동 501호",
    "appraisedValue": 500000000,
    "startingBid": 350000000,
    "finalBid": 400000000,
    "result": "성공",
    "profitOrLoss": 100000000
  }'
```

**JavaScript/TypeScript:**

```typescript
const response = await fetch("/api/sheets/append", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    date: "2025-10-23",
    userId: "user-12345",
    itemTitle: "강남구 래미안 101동 501호",
    appraisedValue: 500000000,
    startingBid: 350000000,
    finalBid: 400000000,
    result: "성공",
    profitOrLoss: 100000000,
  }),
});

const data = await response.json();
console.log(data);
```

### 응답 예시

**성공:**

```json
{
  "success": true,
  "message": "데이터가 구글 시트에 저장되었습니다.",
  "data": {
    "updatedRange": "경매결과!A2:H2",
    "updatedRows": 1
  }
}
```

**실패:**

```json
{
  "success": false,
  "error": "에러 메시지"
}
```

---

## 구글 시트에서 데이터 읽어오기

저장된 데이터를 API를 통해 조회할 수 있습니다.

### API 엔드포인트

```
GET /api/sheets/read?limit=10
```

### 쿼리 파라미터

| 파라미터 | 타입   | 필수 | 기본값 | 설명                          |
| -------- | ------ | ---- | ------ | ----------------------------- |
| limit    | number | X    | 10     | 가져올 데이터 개수 (최대 100) |

### 요청 예시

**curl 사용:**

```bash
curl http://localhost:3000/api/sheets/read?limit=10
```

**JavaScript/TypeScript:**

```typescript
const response = await fetch("/api/sheets/read?limit=10");
const data = await response.json();

if (data.success) {
  console.log("전체 데이터 개수:", data.total);
  console.log("조회된 데이터:", data.data);
}
```

### 응답 예시

```json
{
  "success": true,
  "data": [
    {
      "date": "2025-10-23",
      "userId": "user-12345",
      "itemTitle": "강남구 래미안 101동 501호",
      "appraisedValue": 500000000,
      "startingBid": 350000000,
      "finalBid": 400000000,
      "result": "성공",
      "profitOrLoss": 100000000
    },
    {
      "date": "2025-10-23",
      "userId": "user-12345",
      "itemTitle": "서초구 아이파크 202동 1503호",
      "appraisedValue": 800000000,
      "startingBid": 560000000,
      "finalBid": 650000000,
      "result": "실패",
      "profitOrLoss": -650000000
    }
  ],
  "total": 2,
  "headers": [
    "날짜",
    "사용자ID",
    "매물제목",
    "감정가",
    "시작입찰가",
    "최종입찰가",
    "결과",
    "손익"
  ]
}
```

---

## 데이터 분석 활용

구글 시트에 저장된 데이터를 활용하여 다양한 분석을 수행할 수 있습니다.

### 1. 총 수익/손실 계산

구글 시트의 H열(손익)을 활용합니다:

```
=SUM(H2:H)
```

### 2. 성공률 계산

G열(결과)을 활용합니다:

```
=COUNTIF(G2:G,"성공")/COUNTA(G2:G)*100
```

### 3. 평균 입찰가 계산

F열(최종입찰가)을 활용합니다:

```
=AVERAGE(F2:F)
```

### 4. 차트 생성

1. 데이터 범위 선택 (예: A1:H10)
2. 메뉴에서 "삽입" > "차트" 선택
3. 원하는 차트 유형 선택 (막대 그래프, 원 그래프 등)

**추천 차트:**

- 📊 **손익 추세**: 날짜별 손익을 선 그래프로 표시
- 🥧 **성공/실패 비율**: 원 그래프로 성공률 시각화
- 📈 **매물별 수익**: 매물 제목별 평균 수익 막대 그래프

### 5. 조건부 서식

손익에 따라 색상을 자동으로 변경:

1. H열(손익) 선택
2. 메뉴에서 "서식" > "조건부 서식" 선택
3. 규칙 설정:
   - 값이 0보다 크면 → 초록색 (수익)
   - 값이 0보다 작으면 → 빨간색 (손실)

---

## 문제 해결

### 데이터가 저장되지 않아요

**원인 1: 환경 변수 미설정**

- `.env.local` 파일이 있는지 확인
- 환경 변수가 올바르게 설정되었는지 확인
- 서버를 재시작 (`Ctrl+C` 후 `pnpm run dev`)

**원인 2: 서비스 계정 권한 부족**

- 구글 시트에서 서비스 계정 이메일에 "편집자" 권한이 있는지 확인
- 공유 설정에서 서비스 계정 이메일 추가

**원인 3: 시트 이름 불일치**

- 구글 시트의 시트 이름이 "경매결과"인지 확인
- 대소문자 및 공백 주의

### 데이터를 읽어올 수 없어요

**원인 1: Spreadsheet ID 오류**

- `.env.local`의 `GOOGLE_SHEETS_SPREADSHEET_ID`가 올바른지 확인
- 구글 시트 URL에서 ID 부분 다시 확인

**원인 2: 서비스 계정 권한 부족**

- 구글 시트에서 서비스 계정 이메일에 최소 "뷰어" 권한이 있는지 확인

### API 호출 시 500 에러가 발생해요

**확인 사항:**

1. 서버 로그 확인 (콘솔 에러 메시지)
2. Private Key가 올바르게 설정되었는지 확인
   - 줄바꿈 문자 `\n` 포함
   - `-----BEGIN PRIVATE KEY-----`와 `-----END PRIVATE KEY-----` 포함
3. 네트워크 연결 확인

---

## 🎯 활용 시나리오

### 시나리오 1: 개인 투자 분석

1. 여러 번 입찰 시뮬레이션 진행
2. 구글 시트에 자동으로 데이터 누적
3. 차트로 수익률 추세 분석
4. 성공률이 높은 전략 파악

### 시나리오 2: 팀 공유 및 협업

1. 구글 시트를 팀원들과 공유
2. 실시간으로 입찰 결과 확인
3. 댓글 기능으로 피드백 공유
4. 공동 분석 및 전략 수립

### 시나리오 3: 교육 자료 제작

1. 다양한 시나리오의 입찰 데이터 수집
2. 구글 시트로 케이스 스터디 작성
3. 차트 및 분석 자료 첨부
4. PDF로 내보내기하여 배포

---

## 📚 관련 문서

- [Google Sheets API 설정 가이드](./GOOGLE_SHEETS_API_SETUP.md)
- [Gmail API 설정 가이드](./GMAIL_API_SETUP.md)
- [API 문서](../app/api/README.md)

---

## 💡 팁

1. **정기적인 백업**: 중요한 데이터는 별도로 백업하세요
2. **필터 활용**: 구글 시트의 필터 기능으로 특정 조건의 데이터만 보기
3. **피벗 테이블**: 복잡한 분석은 피벗 테이블 활용
4. **자동화**: Google Apps Script로 추가 자동화 기능 구현 가능
5. **모바일 접근**: Google Sheets 앱으로 모바일에서도 데이터 확인

---

구글 시트 연동으로 더 체계적인 경매 시뮬레이션 분석을 경험하세요! 🎉
