# Gmail API μ„¤μ • κ°€μ΄λ“

μ΄ λ¬Έμ„λ” Gmail APIλ¥Ό μ‚¬μ©ν•μ—¬ μ΄λ©”μΌμ„ μ „μ†΅ν•κΈ° μ„ν• μ„¤μ • λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤.

## π“‹ λ©μ°¨

1. [Google Cloud Console μ„¤μ •](#1-google-cloud-console-μ„¤μ •)
2. [OAuth 2.0 μΈμ¦ μ •λ³΄ μƒμ„±](#2-oauth-20-μΈμ¦-μ •λ³΄-μƒμ„±)
3. [Refresh Token λ°κΈ‰](#3-refresh-token-λ°κΈ‰)
4. [ν™κ²½ λ³€μ μ„¤μ •](#4-ν™κ²½-λ³€μ-μ„¤μ •)
5. [ν…μ¤νΈ](#5-ν…μ¤νΈ)

---

## 1. Google Cloud Console μ„¤μ •

### 1-1. ν”„λ΅μ νΈ μƒμ„±

1. [Google Cloud Console](https://console.cloud.google.com/)μ— μ ‘μ†ν•©λ‹λ‹¤
2. μƒλ‹¨μ ν”„λ΅μ νΈ μ„ νƒ λ“λ΅­λ‹¤μ΄μ„ ν΄λ¦­ν•©λ‹λ‹¤
3. "μƒ ν”„λ΅μ νΈ"λ¥Ό ν΄λ¦­ν•κ³  ν”„λ΅μ νΈ μ΄λ¦„μ„ μ…λ ¥ν•©λ‹λ‹¤ (μ: "bid-master-email")
4. "λ§λ“¤κΈ°" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

### 1-2. Gmail API ν™μ„±ν™”

1. μ™Όμ½ λ©”λ‰΄μ—μ„ "API λ° μ„λΉ„μ¤" > "λΌμ΄λΈλ¬λ¦¬"λ¥Ό μ„ νƒν•©λ‹λ‹¤
2. κ²€μƒ‰μ°½μ— "Gmail API"λ¥Ό μ…λ ¥ν•©λ‹λ‹¤
3. "Gmail API"λ¥Ό ν΄λ¦­ν•κ³  "μ‚¬μ©" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

---

## 2. OAuth 2.0 μΈμ¦ μ •λ³΄ μƒμ„±

### 2-1. OAuth λ™μ ν™”λ©΄ κµ¬μ„±

1. μ™Όμ½ λ©”λ‰΄μ—μ„ "API λ° μ„λΉ„μ¤" > "OAuth λ™μ ν™”λ©΄"μ„ μ„ νƒν•©λ‹λ‹¤
2. "μ™Έλ¶€" λλ” "λ‚΄λ¶€"λ¥Ό μ„ νƒν•©λ‹λ‹¤ (κ°μΈ μ‚¬μ©μλ” "μ™Έλ¶€" μ„ νƒ)
3. ν•„μ μ •λ³΄λ¥Ό μ…λ ¥ν•©λ‹λ‹¤:
   - μ•± μ΄λ¦„: "Bid Master"
   - μ‚¬μ©μ μ§€μ› μ΄λ©”μΌ: λ³ΈμΈμ μ΄λ©”μΌ
   - κ°λ°μ μ—°λ½μ²: λ³ΈμΈμ μ΄λ©”μΌ
4. "μ €μ¥ ν›„ κ³„μ†" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

### 2-2. λ²”μ„(Scope) μ¶”κ°€

1. "λ²”μ„ μ¶”κ°€ λλ” μ‚­μ " λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
2. λ‹¤μ λ²”μ„λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤:
   - `https://www.googleapis.com/auth/gmail.send` (μ΄λ©”μΌ μ „μ†΅)
3. "μ—…λ°μ΄νΈ" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
4. "μ €μ¥ ν›„ κ³„μ†" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

### 2-3. ν…μ¤νΈ μ‚¬μ©μ μ¶”κ°€ (μ™Έλ¶€ μ„ νƒ μ‹)

1. "ν…μ¤νΈ μ‚¬μ©μ" μ„Ήμ…μ—μ„ "μ‚¬μ©μ μ¶”κ°€" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
2. μ΄λ©”μΌ μ „μ†΅μ— μ‚¬μ©ν•  Gmail κ³„μ •μ„ μ…λ ¥ν•©λ‹λ‹¤
3. "μ €μ¥ ν›„ κ³„μ†" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

### 2-4. OAuth 2.0 ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±

1. μ™Όμ½ λ©”λ‰΄μ—μ„ "API λ° μ„λΉ„μ¤" > "μ‚¬μ©μ μΈμ¦ μ •λ³΄"λ¥Ό μ„ νƒν•©λ‹λ‹¤
2. μƒλ‹¨μ "+ μ‚¬μ©μ μΈμ¦ μ •λ³΄ λ§λ“¤κΈ°" > "OAuth ν΄λΌμ΄μ–ΈνΈ ID"λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤
3. μ• ν”λ¦¬μΌ€μ΄μ… μ ν•: "μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…" μ„ νƒ
4. μ΄λ¦„: "Bid Master Web Client" μ…λ ¥
5. μΉμΈλ λ¦¬λ””λ ‰μ… URIμ— λ‹¤μμ„ μ¶”κ°€ν•©λ‹λ‹¤:
   - `https://developers.google.com/oauthplayground`
6. "λ§λ“¤κΈ°" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
7. **ν΄λΌμ΄μ–ΈνΈ ID**μ™€ **ν΄λΌμ΄μ–ΈνΈ λ³΄μ• λΉ„λ°€λ²νΈ**λ¥Ό λ³µμ‚¬ν•΄λ‘΅λ‹λ‹¤ β οΈ μ¤‘μ”!

---

## 3. Refresh Token λ°κΈ‰

### 3-1. OAuth 2.0 Playground μ‚¬μ©

1. [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)μ— μ ‘μ†ν•©λ‹λ‹¤
2. μ¤λ¥Έμ½ μƒλ‹¨μ ν†±λ‹λ°”ν€΄ μ•„μ΄μ½(β™οΈ)μ„ ν΄λ¦­ν•©λ‹λ‹¤
3. "Use your own OAuth credentials" μ²΄ν¬λ°•μ¤λ¥Ό μ„ νƒν•©λ‹λ‹¤
4. μ•μ„ λ³µμ‚¬ν• **Client ID**μ™€ **Client Secret**μ„ μ…λ ¥ν•©λ‹λ‹¤
5. "Close" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤

### 3-2. κ¶ν• μΉμΈ

1. μ™Όμ½μ "Step 1" μ„Ήμ…μ—μ„ λ‹¤μ ν•­λ©μ„ μ°Ύμ•„ μ„ νƒν•©λ‹λ‹¤:
   - `https://mail.google.com/` (λλ” `https://www.googleapis.com/auth/gmail.send`)
2. "Authorize APIs" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
3. Google λ΅κ·ΈμΈ ν™”λ©΄μ΄ λ‚νƒ€λ‚λ©΄ μ΄λ©”μΌ κ³„μ •μΌλ΅ λ΅κ·ΈμΈν•©λ‹λ‹¤
4. κ¶ν• μ”μ²­ ν™”λ©΄μ—μ„ "κ³„μ†" λλ” "ν—μ©"μ„ ν΄λ¦­ν•©λ‹λ‹¤

### 3-3. Refresh Token λ°›κΈ°

1. "Step 2" μ„Ήμ…μ—μ„ "Exchange authorization code for tokens" λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤
2. **Refresh token**μ΄ ν‘μ‹λ©λ‹λ‹¤ - μ΄κ²ƒμ„ λ³µμ‚¬ν•΄λ‘΅λ‹λ‹¤ β οΈ μ¤‘μ”!

---

## 4. ν™κ²½ λ³€μ μ„¤μ •

ν”„λ΅μ νΈ λ£¨νΈμ— `.env.local` νμΌμ„ μƒμ„±ν•κ³  λ‹¤μ λ‚΄μ©μ„ μ…λ ¥ν•©λ‹λ‹¤:

```env
# Gmail API (μ΄λ©”μΌ μ „μ†΅μ©)
GMAIL_CLIENT_ID="your-client-id.apps.googleusercontent.com"
GMAIL_CLIENT_SECRET="your-client-secret"
GMAIL_REFRESH_TOKEN="your-refresh-token"
GMAIL_USER_EMAIL="your-email@gmail.com"
```

κ° ν•­λ©μ„ μ•μ„ λ³µμ‚¬ν• κ°’μΌλ΅ κµμ²΄ν•©λ‹λ‹¤:

- `GMAIL_CLIENT_ID`: OAuth ν΄λΌμ΄μ–ΈνΈ ID
- `GMAIL_CLIENT_SECRET`: OAuth ν΄λΌμ΄μ–ΈνΈ λ³΄μ• λΉ„λ°€λ²νΈ
- `GMAIL_REFRESH_TOKEN`: OAuth Playgroundμ—μ„ λ°›μ€ Refresh Token
- `GMAIL_USER_EMAIL`: μ΄λ©”μΌμ„ μ „μ†΅ν•  Gmail κ³„μ •

β οΈ **μ¤‘μ”**: `.env.local` νμΌμ€ μ λ€ Gitμ— μ»¤λ°‹ν•μ§€ λ§μ„Έμ”!

---

## 5. ν…μ¤νΈ

### 5-1. μ„λ²„ μ‹¤ν–‰

```bash
pnpm run dev
```

### 5-2. API ν…μ¤νΈ

λ‹¤μκ³Ό κ°™μ΄ APIλ¥Ό νΈμ¶ν•μ—¬ ν…μ¤νΈν•©λ‹λ‹¤:

```bash
curl -X POST http://localhost:3000/api/send-email \
  -H "Content-Type: application/json" \
  -d '{
    "to": "recipient@example.com",
    "subject": "ν…μ¤νΈ μ΄λ©”μΌ",
    "text": "μ΄λ©”μΌ μ „μ†΅ ν…μ¤νΈμ…λ‹λ‹¤.",
    "html": "<h1>ν…μ¤νΈ</h1><p>μ΄λ©”μΌ μ „μ†΅ ν…μ¤νΈμ…λ‹λ‹¤.</p>"
  }'
```

λλ” Postman, Thunder Client λ“±μ API ν…μ¤νΈ λ„κµ¬λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

### 5-3. κ²°κ³Ό ν™•μΈ

- μ„±κ³µ μ‹: `{ "success": true, "message": "μ΄λ©”μΌμ΄ μ„±κ³µμ μΌλ΅ μ „μ†΅λμ—μµλ‹λ‹¤." }`
- μ‹¤ν¨ μ‹: `{ "success": false, "error": "μ—λ¬ λ©”μ‹μ§€" }`

λΈλΌμ°μ € μ½μ†”μ΄λ‚ μ„λ²„ λ΅κ·Έμ—μ„ λ‹¤μ μ΄λ¨μ§€λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤:

- π“§ μ΄λ©”μΌ μ „μ†΅ μ”μ²­ μ‹μ‘
- β‰οΈ μ΄λ©”μΌ λ©”μ‹μ§€ μΈμ½”λ”© μ™„λ£
- π“¤ Gmail APIλ¥Ό ν†µν•΄ μ΄λ©”μΌ μ „μ†΅ μ¤‘
- β… μ΄λ©”μΌ μ „μ†΅ μ„±κ³µ
- β μ—λ¬ λ°μƒ

---

## π”§ λ¬Έμ  ν•΄κ²°

### "Gmail API ν™κ²½ λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤"

- `.env.local` νμΌμ΄ ν”„λ΅μ νΈ λ£¨νΈμ— μλ”μ§€ ν™•μΈν•©λ‹λ‹¤
- ν™κ²½ λ³€μ μ΄λ¦„μ΄ μ •ν™•ν•μ§€ ν™•μΈν•©λ‹λ‹¤
- μ„λ²„λ¥Ό μ¬μ‹μ‘ν•©λ‹λ‹¤

### "invalid_grant" μ—λ¬

- Refresh Tokenμ΄ λ§λ£λμ—κ±°λ‚ μλ»λμ—μµλ‹λ‹¤
- OAuth 2.0 Playgroundμ—μ„ λ‹¤μ‹ Refresh Tokenμ„ λ°κΈ‰λ°›μµλ‹λ‹¤

### "Insufficient Permission" μ—λ¬

- OAuth λ™μ ν™”λ©΄μ—μ„ μ¬λ°”λ¥Έ scopeλ¥Ό μ¶”κ°€ν–λ”μ§€ ν™•μΈν•©λ‹λ‹¤
- `https://www.googleapis.com/auth/gmail.send` κ¶ν•μ΄ ν•„μ”ν•©λ‹λ‹¤

### "User not found" μ—λ¬

- `GMAIL_USER_EMAIL`μ΄ OAuth μΈμ¦μ— μ‚¬μ©ν• μ΄λ©”μΌκ³Ό λ™μΌν•μ§€ ν™•μΈν•©λ‹λ‹¤

---

## π“ μ°Έκ³  μλ£

- [Google Gmail API κ³µμ‹ λ¬Έμ„](https://developers.google.com/gmail/api)
- [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)
- [Google Cloud Console](https://console.cloud.google.com/)

---

## β… μ²΄ν¬λ¦¬μ¤νΈ

μ„¤μ •μ΄ μ™„λ£λμ—λ”μ§€ ν™•μΈν•μ„Έμ”:

- [ ] Google Cloud ν”„λ΅μ νΈ μƒμ„±
- [ ] Gmail API ν™μ„±ν™”
- [ ] OAuth 2.0 ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±
- [ ] Refresh Token λ°κΈ‰
- [ ] `.env.local` νμΌμ— ν™κ²½ λ³€μ μ„¤μ •
- [ ] API ν…μ¤νΈ μ„±κ³µ

λ¨λ“  ν•­λ©μ΄ μ™„λ£λλ©΄ μ΄λ©”μΌ μ „μ†΅ κΈ°λ¥μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤! π‰
