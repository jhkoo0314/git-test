# 사용자 정보 구글 시트 연동 설정 가이드

Bid Master에서 사용자 정보(이름, 이메일)를 구글 시트에 자동으로 수집하는 기능을 설정하는 방법을 설명합니다.

## 📋 목차

1. [개요](#개요)
2. [구글 시트 준비](#구글-시트-준비)
3. [환경 변수 설정](#환경-변수-설정)
4. [테스트](#테스트)
5. [문제 해결](#문제-해결)

---

## 개요

Bid Master는 사용자가 이름과 이메일을 입력하면 자동으로 구글 시트에 저장하는 기능을 제공합니다.

### 주요 기능

- ✅ **자동 수집**: 사용자 정보 입력 시 자동으로 구글 시트에 저장
- 📊 **데이터 관리**: 구글 시트에서 수집된 사용자 정보 확인 및 관리
- 🔄 **실시간 동기화**: 여러 기기에서 실시간으로 데이터 확인
- 📈 **분석 지원**: 구글 시트의 차트 및 함수를 활용한 데이터 분석

### 저장되는 데이터

구글 시트에는 다음 정보가 저장됩니다:

| 항목       | 설명             | 예시                     |
| ---------- | ---------------- | ------------------------ |
| 이름       | 사용자 이름      | 홍길동                   |
| 이메일     | 사용자 이메일    | hong@example.com         |
| 목적       | 수집 목적        | 상세 리포트 출시 알림    |
| 메타데이터 | 추가 정보 (JSON) | {"source": "bid-master"} |
| 시간       | 수집 시간        | 2025-01-23 14:30:25      |

---

## 구글 시트 준비

### 1. 새 구글 시트 생성

1. [Google Sheets](https://sheets.google.com/)에 접속합니다
2. 빈 스프레드시트를 새로 만듭니다
3. 시트 이름을 "Bid Master 사용자 정보"로 변경합니다
4. 첫 번째 시트의 이름을 "사용자정보"로 변경합니다

### 2. 헤더 행 추가

첫 번째 행(1행)에 다음 헤더를 입력합니다:

| A    | B      | C    | D          | E    |
| ---- | ------ | ---- | ---------- | ---- |
| 이름 | 이메일 | 목적 | 메타데이터 | 시간 |

### 3. 시트 URL 복사

1. 브라우저 주소창의 URL을 확인합니다
2. URL 형식: `https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit#gid=0`
3. **SPREADSHEET_ID 부분을 복사**해둡니다

### 4. 서비스 계정 권한 부여

1. 구글 시트 오른쪽 상단의 "공유" 버튼을 클릭합니다
2. 서비스 계정 이메일을 입력합니다 (예: `bid-master-sheets@your-project-id.iam.gserviceaccount.com`)
3. 권한을 "편집자"로 설정합니다
4. "완료" 버튼을 클릭합니다

⚠️ **중요**: 서비스 계정 이메일에 편집 권한을 부여하지 않으면 API에서 시트에 접근할 수 없습니다!

---

## 환경 변수 설정

### 1. .env.local 파일 생성

프로젝트 루트에 `.env.local` 파일을 생성하고 다음 내용을 추가합니다:

```env
# Google Sheets API 설정 (사용자 정보 수집용)
GOOGLE_SHEETS_SPREADSHEET_ID="your-spreadsheet-id"
GOOGLE_SERVICE_ACCOUNT_EMAIL="your-service-account@your-project-id.iam.gserviceaccount.com"
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nyour-private-key\n-----END PRIVATE KEY-----\n"
```

### 2. 환경 변수 값 설정

각 항목을 다음과 같이 설정합니다:

- `GOOGLE_SHEETS_SPREADSHEET_ID`: 구글 시트 URL에서 복사한 ID
- `GOOGLE_SERVICE_ACCOUNT_EMAIL`: JSON 파일의 `client_email` 값
- `GOOGLE_PRIVATE_KEY`: JSON 파일의 `private_key` 값 (줄바꿈 포함)

⚠️ **주의사항**:

- `GOOGLE_PRIVATE_KEY`는 반드시 따옴표로 감싸야 합니다
- `\n` 문자가 실제 줄바꿈이 아닌 문자열로 포함되어야 합니다
- `.env.local` 파일은 절대 Git에 커밋하지 마세요!

### 3. .gitignore 확인

`.gitignore` 파일에 다음 내용이 포함되어 있는지 확인합니다:

```gitignore
# 환경 변수
.env
.env.local
.env*.local

# Google 서비스 계정 키
google-service-account.json
```

---

## 테스트

### 1. 서버 실행

```bash
pnpm run dev
```

### 2. 사용자 정보 수집 테스트

1. 웹사이트에서 "상세 리포트 보기" 버튼 클릭
2. 사용자 정보 모달에서 이름과 이메일 입력
3. "출시 알림 신청" 버튼 클릭
4. 성공 메시지 확인

### 3. 구글 시트 확인

1. 구글 시트를 새로고침합니다
2. "사용자정보" 시트를 확인합니다
3. 새로운 행에 사용자 정보가 추가되었는지 확인합니다

**서버 로그:**

```
👤 사용자 정보 수집 API 호출
📝 수집된 사용자 정보: { name: "홍길동", email: "hong@example.com" }
📊 구글 시트에 사용자 정보 추가: { name: "홍길동", email: "hong@example.com" }
✅ 구글 시트 사용자 정보 추가 성공
```

---

## 문제 해결

### 데이터가 저장되지 않아요

**원인 1: 환경 변수 미설정**

- `.env.local` 파일이 있는지 확인
- 환경 변수가 올바르게 설정되었는지 확인
- 서버를 재시작 (`Ctrl+C` 후 `pnpm run dev`)

**원인 2: 서비스 계정 권한 부족**

- 구글 시트에서 서비스 계정 이메일에 "편집자" 권한이 있는지 확인
- 공유 설정에서 서비스 계정 이메일 추가

**원인 3: 시트 이름 불일치**

- 구글 시트의 시트 이름이 "사용자정보"인지 확인
- 대소문자 및 공백 주의

### API 호출 시 500 에러가 발생해요

**확인 사항:**

1. 서버 로그 확인 (콘솔 에러 메시지)
2. Private Key가 올바르게 설정되었는지 확인
   - 줄바꿈 문자 `\n` 포함
   - `-----BEGIN PRIVATE KEY-----`와 `-----END PRIVATE KEY-----` 포함
3. 네트워크 연결 확인

### "Google Sheets API 환경 변수가 설정되지 않았습니다" 에러

- `.env.local` 파일이 프로젝트 루트에 있는지 확인
- 환경 변수 이름이 정확한지 확인
- 서버를 재시작

---

## 🎯 활용 시나리오

### 시나리오 1: 사용자 리드 수집

1. 웹사이트 방문자가 상세 리포트 기능에 관심을 보임
2. 이름과 이메일을 입력하여 출시 알림 신청
3. 구글 시트에 자동으로 사용자 정보 저장
4. 마케팅 팀에서 리드 관리 및 후속 연락

### 시나리오 2: 사용자 분석

1. 구글 시트에서 수집된 사용자 데이터 분석
2. 사용자 유입 경로별 분석 (source 필드 활용)
3. 시간대별 사용자 수집 패턴 분석
4. 마케팅 전략 수립에 활용

### 시나리오 3: 자동화된 이메일 발송

1. 구글 시트의 사용자 정보를 활용
2. Google Apps Script로 자동 이메일 발송
3. 정기적인 뉴스레터 발송
4. 출시 소식 자동 알림

---

## 📚 관련 문서

- [Google Sheets API 설정 가이드](./GOOGLE_SHEETS_API_SETUP.md)
- [Gmail API 설정 가이드](./GMAIL_API_SETUP.md)
- [API 문서](../app/api/README.md)

---

## 💡 팁

1. **정기적인 백업**: 중요한 사용자 데이터는 별도로 백업하세요
2. **필터 활용**: 구글 시트의 필터 기능으로 특정 조건의 사용자만 보기
3. **피벗 테이블**: 복잡한 분석은 피벗 테이블 활용
4. **자동화**: Google Apps Script로 추가 자동화 기능 구현 가능
5. **모바일 접근**: Google Sheets 앱으로 모바일에서도 데이터 확인

---

구글 시트 연동으로 체계적인 사용자 정보 수집을 경험하세요! 🎉
